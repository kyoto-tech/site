---
import { marked } from "marked";

type Paragraph = {
	type: "paragraph";
	text: string;
};

type List = {
	type: "list";
	intro?: string;
	items: string[];
};

type Activity = {
	title: string;
	content: Array<Paragraph | List>;
};

type Props = {
	activities: Activity[];
};

const renderBlockMarkdown = (value: string) => (marked.parse(value, { async: false }) as string).trim();
const renderInlineMarkdown = (value: string) =>
	(marked.parseInline(value, { async: false }) as string).trim();

const { activities } = Astro.props as Props;
---

<div class="mt-10 grid gap-8 md:grid-cols-2">
	{activities.map((activity) => (
		<article class="rounded-3xl bg-white/95 p-6 shadow-xl shadow-stone-900/5 ring-1 ring-white/60">
			<h3 class="text-xl font-semibold text-slate-900">{activity.title}</h3>
			{activity.content.map((block) =>
				block.type === "paragraph" ? (
					<div
						class="mt-3 text-base leading-relaxed text-slate-600 [&>p]:mb-4 [&>p:last-child]:mb-0"
						set:html={renderBlockMarkdown(block.text)}
					></div>
				) : (
					<div class="mt-4 space-y-3">
						{block.intro && (
							<div
								class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500"
								set:html={renderInlineMarkdown(block.intro)}
							></div>
						)}
						<ul class="list-disc space-y-2 pl-5 text-base leading-relaxed text-slate-600">
							{block.items.map((item) => (
								<li>
									<span set:html={renderInlineMarkdown(item)}></span>
								</li>
							))}
						</ul>
					</div>
				)
			)}
		</article>
	))}
</div>
